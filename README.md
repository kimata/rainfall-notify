# é›¨é™ã‚Šé€šçŸ¥ã‚¢ãƒ—ãƒª

[![Regression](https://github.com/kimata/rainfall-notify/actions/workflows/regression.yaml/badge.svg)](https://github.com/kimata/rainfall-notify/actions/workflows/regression.yaml)

## æ¦‚è¦

ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç›£è¦–ã—ã¦é›¨ãŒé™ã‚Šå§‹ã‚ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ¤œçŸ¥ã—ã€LINE é€šçŸ¥ã¨éŸ³å£°ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã§çŸ¥ã‚‰ã›ã‚‹ Python ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- ğŸŒ§ï¸ **é›¨é™ã‚Šæ¤œçŸ¥**: InfluxDB ã«è“„ç©ã•ã‚ŒãŸã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é›¨ã®é™ã‚Šå§‹ã‚ã‚’æ¤œçŸ¥
- ğŸ” **èª¤æ¤œçŸ¥é˜²æ­¢**: æ—¥å°„é‡ãƒ‡ãƒ¼ã‚¿ï¼ˆ600W/mÂ² ä»¥ä¸Šï¼‰ã‚’ä½¿ç”¨ã—ãŸå…‰å­¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒã‚¤ã‚ºé™¤å»
- ğŸ“± **LINE é€šçŸ¥**: æ°—è±¡ãƒ¬ãƒ¼ãƒ€ãƒ¼ç”»åƒä»˜ãã®é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
- ğŸ”Š **éŸ³å£°é€šçŸ¥**: è¨­å®šå¯èƒ½ãªæ™‚é–“å¸¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 7-21 æ™‚ï¼‰ã§ã®éŸ³å£°ã‚¢ãƒŠã‚¦ãƒ³ã‚¹
- ğŸŒ¦ï¸ **å¤©æ°—äºˆå ±çµ±åˆ**: Yahoo å¤©æ°—ã‹ã‚‰3æ™‚é–“å…ˆã¾ã§ã®é™æ°´é‡äºˆå ±ã‚’å–å¾—
- â±ï¸ **é‡è¤‡é€šçŸ¥é˜²æ­¢**: 30åˆ†é–“ã®é‡è¤‡é€šçŸ¥æŠ‘åˆ¶æ©Ÿèƒ½

## ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

- Python 3.10 ä»¥ä¸Š
- InfluxDBï¼ˆã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨ï¼‰
- LINE Bot API ãƒˆãƒ¼ã‚¯ãƒ³
- éŸ³å£°åˆæˆã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Rye ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ˆæ¨å¥¨ï¼‰
rye sync

# ã¾ãŸã¯ pip ã‚’ä½¿ç”¨
pip install -r requirements.txt
```

## è¨­å®š

1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ:
   ```bash
   cp config.example.yaml config.yaml
   ```

2. `config.yaml` ã‚’ç·¨é›†ã—ã¦ä»¥ä¸‹ã®é …ç›®ã‚’è¨­å®š:
   - InfluxDB æ¥ç¶šæƒ…å ±ï¼ˆURLã€ãƒˆãƒ¼ã‚¯ãƒ³ã€ãƒã‚±ãƒƒãƒˆåï¼‰
   - LINE Bot API ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
   - ã‚»ãƒ³ã‚µãƒ¼è¨­å®šï¼ˆé›¨é‡è¨ˆã€æ—¥å°„è¨ˆï¼‰
   - éŸ³å£°é€šçŸ¥ã‚µãƒ¼ãƒãƒ¼ URL
   - é€šçŸ¥æ™‚é–“å¸¯ã®è¨­å®š

### è¨­å®šä¾‹

```yaml
influxdb:
  url: http://your-influxdb-server:8086
  token: your-influxdb-token
  bucket: sensor

notify:
  line:
    channel:
      access_token: your-line-bot-token
  voice:
    hour:
      start: 8
      end: 21

sensor:
  rain_fall:
    hostname: weather-sensor
    measure: sensor.rainfall
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å®Ÿè¡Œ

```bash
# ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
python src/app.py

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
python src/app.py -c config.yaml

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
python src/app.py -D

# ç›£è¦–å›æ•°ã‚’åˆ¶é™ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
python src/app.py -n 10
```

### ç›£è¦–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½“å®Ÿè¡Œ

```bash
# ç›£è¦–æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
python src/rainfall/monitor.py -c config.yaml -D
```

## é–‹ç™º

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãï¼‰
rye run pytest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª
open tests/evidence/coverage/index.html
```

### ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

```bash
# ãƒªãƒ³ãƒˆå®Ÿè¡Œ
rye run ruff check .

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®Ÿè¡Œ
rye run ruff format .
```

## Docker ã§ã®å®Ÿè¡Œ

### ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
docker build -t rainfall-notify .
```

### ã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œ

```bash
docker run -d \
  --name rainfall-notify \
  -v $(pwd)/config.yaml:/app/config.yaml \
  -v /dev/shm:/dev/shm \
  rainfall-notify
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
InfluxDB â†’ Monitor â†’ Weather APIs â†’ Notifications
   â†“           â†“            â†“            â†“
ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿  é›¨æ¤œçŸ¥å‡¦ç†   å¤©æ°—äºˆå ±å–å¾—   LINE/éŸ³å£°é€šçŸ¥
```

### å‡¦ç†ãƒ•ãƒ­ãƒ¼

1. **ãƒ‡ãƒ¼ã‚¿åé›†**: InfluxDB ã‹ã‚‰ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆé›¨é‡ã€æ—¥å°„é‡ï¼‰ã‚’å–å¾—
2. **é›¨æ¤œçŸ¥**: é›¨é‡ã—ãã„å€¤ï¼ˆ0.1mmï¼‰ã‚’è¶…éã§é›¨é–‹å§‹ã‚’åˆ¤å®š
3. **èª¤æ¤œçŸ¥é™¤å»**: æ—¥å°„é‡ > 600W/mÂ² ã®å ´åˆã¯èª¤æ¤œçŸ¥ã¨ã—ã¦é™¤å¤–
4. **å¤©æ°—äºˆå ±å–å¾—**: Yahoo å¤©æ°—ã‹ã‚‰3æ™‚é–“å…ˆã®é™æ°´é‡äºˆå ±ã‚’å–å¾—
5. **é€šçŸ¥é€ä¿¡**: LINE ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨éŸ³å£°ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã§é€šçŸ¥

## å¯¾å¿œã‚»ãƒ³ã‚µãƒ¼

- é›¨é‡è¨ˆï¼ˆå…‰å­¦å¼ã€è»¢å€’ã¾ã™å¼ï¼‰
- æ—¥å°„è¨ˆï¼ˆèª¤æ¤œçŸ¥é˜²æ­¢ç”¨ï¼‰

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ Apache License Version 2.0 ã®ã‚‚ã¨ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

<div align="center">

**â­ ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå½¹ã«ç«‹ã£ãŸå ´åˆã¯ã€Star ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼**

[ğŸ› Issue å ±å‘Š](https://github.com/kimata/rainfall-notify/issues) | [ğŸ’¡ Feature Request](https://github.com/kimata/rainfall-notify/issues/new?template=feature_request.md) | [ğŸ“– Wiki](https://github.com/kimata/rainfall-notify/wiki)

</div>
